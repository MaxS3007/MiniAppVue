# —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –±–æ—Ç–∞ (–æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, –æ—Ç–≤–µ—Ç –Ω–∞ callback –∏ —Ç.–¥.)
import json
from datetime import datetime
from httpx import AsyncClient
from app.config import settings


async def bot_send_message(client: AsyncClient, chat_id: int, text: str, kb: list | None = None):
    send_data = {"chat_id": chat_id, "text": text, "parse_mode": "HTML"}
    if kb:
        send_data["reply_markup"] = {"inline_keyboard": kb}
    await client.post(f"{settings.get_tg_api_url()}/sendMessage", json=send_data)


async def call_answer(client: AsyncClient, callback_query_id: int, text: str):
    await client.post(f"{settings.get_tg_api_url()}/answerCallbackQuery", json={
        "callback_query_id": callback_query_id,
        "text": text
    })


def get_greeting_text(first_name: str):
    return f"""
üè• <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–æ—Ç –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ "–ú–æ—Ä–µ –ò–¥–µ–π"!</b>
–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, <b>{first_name}</b>! üëã
–ú—ã —Ä–∞–¥—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤–∞—Å –≤ –Ω–∞—à–µ–π —Ü–∏—Ñ—Ä–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏. –ó–¥–µ—Å—å –≤—ã —Å–º–æ–∂–µ—Ç–µ:
‚úÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É –ø–æ –≤–æ–ø—Ä–æ—Å–º –±–∏–∑–Ω–µ—Å–∞
üóì –£–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ –∑–∞–ø–∏—Å—è–º–∏
‚ÑπÔ∏è –ü–æ–ª—É—á–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∞—à–∏—Ö —É—Å–ª—É–≥–∞—Ö

<i>–ú–æ—Ä–µ –ò–¥–µ–π - –í–∞—à –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –≤ –º–æ—Ä–µ –±–∏–∑–Ω–µ—Å–∞!</i>
–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å, –≤—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π –ø—É–Ω–∫—Ç –º–µ–Ω—é –Ω–∏–∂–µ üëá
"""


def get_about_text():
    return """
üè• <b>–û –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ "–ú–æ—Ä–µ –ò–¥–µ–π"</b>
–ú—ã - —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π –∏ –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–Ω–µ—Ä–æ–≤, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ –ø–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å–∞ —Å 2016 –≥–æ–¥–∞.

<b>–ù–∞—à–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</b>

‚úÖ –ö–æ–º–∞–Ω–¥–∞ –æ–ø—ã—Ç–Ω—ã—Ö –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ–≤ –∏ –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π
üèÜ –õ—É—á—à–∏–µ –º–µ—Ç–æ–¥–∏–∫–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –ø—Ä–æ–∫–∞—á–∫–∏ –±–∏–∑–Ω–µ—Å–∞
üïí –£–¥–æ–±–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã: —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏ —Å 10:00 –¥–æ 18:00
üè† –ö–æ–º—Ñ–æ—Ä—Ç–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ —Ü–µ–Ω—Ç—Ä–µ –≥–æ—Ä–æ–¥–∞
üíâ –®–∏—Ä–æ–∫–∏–π —Å–ø–µ–∫—Ç—Ä –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–æ–Ω–Ω—ã—Ö —É—Å–ª—É–≥

<b>–ú—ã –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–µ–º –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º:</b>
‚Ä¢ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –±–∏–∑–Ω–µ—Å–∞
‚Ä¢ –ë–∏–∑–Ω–µ—Å –º–æ–¥–µ–ª—å
‚Ä¢ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –º–æ–¥–µ–ª—å
‚Ä¢ –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∏ –ü—Ä–æ–¥–∞–∂–∏
‚Ä¢ –õ–∏—á–Ω—ã–π –±—Ä–µ–Ω–¥ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è
‚Ä¢ –†–∞–±–æ—Ç–∞ —Å –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º
‚Ä¢ –ú–µ—Ä—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±–∏–∑–Ω–µ—Å–∞

<i>–ú—ã –∑–∞–±–æ—Ç–∏–º—Å—è –æ –≤–∞—à–µ–º –±–∏–∑–Ω–µ—Å–µ –≤–º–µ—Å—Ç–µ —Å –í–∞–º–∏ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ!</i>

–ß—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –∏–ª–∏ —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ –Ω–∞—à–∏—Ö —É—Å–ª—É–≥–∞—Ö, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –º–µ–Ω—é –±–æ—Ç–∞.
"""


def pluralize_appointments(count: int) -> str:
    if count == 1:
        return "–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è"
    elif 2 <= count <= 4:
        return "–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏"
    else:
        return "–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π"


def get_booking_text(appointment_count):
    if appointment_count > 0:
        message_text = f"""
üìÖ <b>–í–∞—à–∏ –∑–∞–ø–∏—Å–∏ –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º</b>
–£ –≤–∞—Å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ <b>{appointment_count}</b> {pluralize_appointments(appointment_count)}.

–ß—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏ –≤–∞—à–∏—Ö –∑–∞–ø–∏—Å–µ–π, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–ø–∏—Å–∏" –Ω–∏–∂–µ.
"""
    else:
        message_text = """
üìÖ <b>–í–∞—à–∏ –∑–∞–ø–∏—Å–∏ –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º</b>

–í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è —É –≤–∞—Å –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á.

–ß—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∫–Ω–æ–ø–∫–æ–π "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é.
"""
    return message_text


def format_appointment(appointment, start_text="üóì <b>–ó–∞–ø–∏—Å—å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</b>"):
    appointment_date = datetime.strptime(appointment['day_booking'], '%Y-%m-%d').strftime('%d.%m.%Y')
    return f"""
{start_text}

üìÖ –î–∞—Ç–∞: {appointment_date}
üïí –í—Ä–µ–º—è: {appointment['time_booking']}
üë®‚Äç‚öïÔ∏è –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: {appointment['doctor_full_name']}
üè• –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: {appointment['special']}

‚ÑπÔ∏è –ù–æ–º–µ—Ä –∑–∞–ø–∏—Å–∏: {appointment['id']}

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏—Ö–æ–¥–∏—Ç–µ –∑–∞ 10-15 –º–∏–Ω—É—Ç –¥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.
"""
